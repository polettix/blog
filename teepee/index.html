<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>TeePee &#8211; PolettiX!</title>
<meta name="description" content="Get the most out of your APIs… from the shell!

">
<meta name="keywords" content="">



<!-- Twitter Cards -->
<meta name="twitter:title" content="TeePee">
<meta name="twitter:description" content="Get the most out of your APIs… from the shell!

">
<meta name="twitter:site" content="@polettix">
<meta name="twitter:creator" content="@polettix">

<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="/images/teepee.jpg">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="TeePee">
<meta property="og:description" content="Get the most out of your APIs… from the shell!

">
<meta property="og:url" content="/teepee/">
<meta property="og:site_name" content="PolettiX!">





<link rel="canonical" href="/teepee/">
<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="PolettiX! Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<meta http-equiv="cleartype" content="on">

<!-- HTML5 Shiv and Media Query Support -->
<!--[if lt IE 9]>
	<script src="/assets/js/vendor/html5shiv.min.js"></script>
	<script src="/assets/js/vendor/respond.min.js"></script>
<![endif]-->

<!-- Modernizr -->
<script src="/assets/js/vendor/modernizr-2.7.1.custom.min.js"></script>

<link href='//fonts.googleapis.com/css?family=PT+Sans+Narrow:400,700%7CPT+Serif:400,700,400italic' rel='stylesheet' type='text/css'>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="/favicon.ico?whatever">
<!-- 32x32 -->
<link rel="shortcut icon" href="/favicon.png?whatever">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/images/apple-touch-icon-144x144-precomposed.png">

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

</head>

<body class="post">

<!--[if lt IE 9]><div class="browser-upgrade alert alert-info">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div><![endif]-->

<div class="navigation-wrapper">
	<div class="site-name">
		<!-- a href="/">PolettiX!</a -->
      <a href="/"><img style="height: 1.2em" src="/images/polettix.png" alt="PolettiX!"></a>
	</div><!-- /.site-name -->
	<div class="top-navigation">
		<nav role="navigation" id="site-nav" class="nav">
		    <ul>
		        
				    
				        
				    
				    <li><a href="/about/" >About</a></li>
				
				    
				        
				    
				    <li><a href="/posts/" >Posts</a></li>
				
		    </ul>
		</nav>
	</div><!-- /.top-navigation -->
</div><!-- /.navigation-wrapper -->



  <div class="image-wrap">
  <img src=
    
      "/images/teepee.jpg"
    
  alt="TeePee feature image">
  
    <span class="image-credit"><a href="#fn:credits">Ralph Irving Gifford and H.H. Tammen (at US Library of Congress)</a></span>
  
  </div><!-- /.image-wrap -->


<div id="main" role="main">
  <div class="article-author-side">
    


<div itemscope itemtype="http://schema.org/Person">


	<img src="/images/flavio-self-color.png" class="bio-photo" alt="Flavio Poletti bio photo">


  <h3 itemprop="name">Flavio Poletti</h3>
  <p>Irreducible Perler.</p>
  <a href="mailto:flavio@polettix.it" class="author-social" target="_blank"><i class="fa fa-fw fa-envelope-square"></i>Email</a>
  <a href="http://comics.polettix.it/" class="author-social" target="_blank"><i class="fa fa-fw fa-pencil"></i> Comics</a>
  <a href="http://twitter.com/polettix" class="author-social" target="_blank"><i class="fa fa-fw fa-twitter-square"></i> Twitter</a>
  
  
  <a href="http://linkedin.com/in/flaviopoletti" class="author-social" target="_blank"><i class="fa fa-fw fa-linkedin-square"></i> LinkedIn</a>
  
  
  <a href="https://metacpan.org/author/polettix" class="author-social" target="_blank"><i class="fa fa-fw fa-th-large"></i> MetaCPAN</a>
  <a href="http://github.com/polettix" class="author-social" target="_blank"><i class="fa fa-fw fa-github"></i> Github</a>
  <a href="http://stackoverflow.com/users/3865403/polettix" class="author-social" target="_blank"><i class="fa fa-fw fa-stack-overflow"></i> Stackoverflow</a>
  
  
  <a href="http://www.pinterest.com/polettix" class="author-social" target="_blank"><i class="fa fa-fw fa-pinterest"></i> Pinterest</a>
  
  
  
  
  
  
</div>

  </div>
  <article class="post">
    <div class="headline-wrap">
      
        <h1><a href="/teepee/" rel="bookmark" title="TeePee">TeePee</a></h1>
      
    </div><!--/ .headline-wrap -->
    <div class="article-wrap">
      <p>Get the most out of your APIs… from the shell!</p>

<p>I sometimes need to read values from a configuration file or a response
to an API call from the shell. Most of the times they come either in
JSON or YAML format… which is when <code>teepee</code> comes handy.</p>

<p>Why the name, in the first place? It heavily relies upon the Perl
distribution/module
<a href="https://metacpan.org/pod/Template::Perlish">Template::Perlish</a>, whose
initials are <em>Ti Pi</em>. Hence… <code>teepee</code>.<sup id="fnref:credits"><a href="#fn:credits" class="footnote">1</a></sup></p>

<h2 id="table-of-contents">Table of Contents</h2>

<ul id="markdown-toc">
  <li><a href="#table-of-contents" id="markdown-toc-table-of-contents">Table of Contents</a></li>
  <li><a href="#quick" id="markdown-toc-quick">Quick! Show Me Something!</a></li>
  <li><a href="#setting-up" id="markdown-toc-setting-up">Setting Up</a></li>
  <li><a href="#getting-a-value" id="markdown-toc-getting-a-value">Getting A Value</a></li>
  <li><a href="#using-available-inputs" id="markdown-toc-using-available-inputs">Using Available Inputs</a></li>
  <li><a href="#expanding-templates" id="markdown-toc-expanding-templates">Expanding Templates</a></li>
  <li><a href="#array" id="markdown-toc-array">Iterating Over an Array</a></li>
  <li><a href="#handy-shortcuts" id="markdown-toc-handy-shortcuts">Handy Shortcuts</a></li>
  <li><a href="#yet-another-input-channel" id="markdown-toc-yet-another-input-channel">Yet Another Input Channel</a></li>
  <li><a href="#reshaping" id="markdown-toc-reshaping">Reshaping</a></li>
  <li><a href="#pretty-printing-and-isolating" id="markdown-toc-pretty-printing-and-isolating">Pretty-Printing and Isolating</a></li>
  <li><a href="#a-few-examples" id="markdown-toc-a-few-examples">A Few Examples</a>    <ul>
      <li><a href="#whats-the-weather-like" id="markdown-toc-whats-the-weather-like">What’s the Weather Like?</a></li>
      <li><a href="#where-can-i-go-from" id="markdown-toc-where-can-i-go-from">Where Can I Go From…</a></li>
      <li><a href="#whats-the-last-xkcd-strip" id="markdown-toc-whats-the-last-xkcd-strip">What’s the Last xkcd Strip?</a></li>
      <li><a href="#and-so-on" id="markdown-toc-and-so-on">… And So On…</a></li>
    </ul>
  </li>
  <li><a href="#times-up" id="markdown-toc-times-up">Time’s Up!</a></li>
</ul>

<h2 id="quick">Quick! Show Me Something!</h2>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># something about me</span>
<span class="nv">metacpan</span><span class="o">=</span><span class="s1">&#39;http://api.metacpan.org/v0&#39;</span>
curl <span class="s2">&quot;$metacpan/author/POLETTIX&quot;</span> <span class="se">\</span>
  <span class="p">|</span> teepee -nT <span class="s2">&quot;Hi! I&#39;m [% name %] &lt;[% email.0 %]&gt;.&quot;</span>
<span class="c"># Hi! I&#39;m Flavio Poletti &lt;polet...pan.org&gt;.</span>

<span class="c"># for extracting multiple data, let&#39;s cache in a variable</span>
<span class="nv">me</span><span class="o">=</span><span class="k">$(</span>curl <span class="s2">&quot;$metacpan/author/POLETTIX&quot;</span><span class="k">)</span>
teepee -I <span class="s2">&quot;$me&quot;</span> -nT <span class="s1">&#39;See my big face at [% gravatar_url %]?s=200&#39;</span>
<span class="c"># See my big face at http://www.gravatar.com/av...b57.png?s=200</span>

<span class="c"># my favourite band</span>
<span class="nv">mbrz</span><span class="o">=</span><span class="s1">&#39;http://musicbrainz.org/ws/2&#39;</span>
<span class="nv">pjq</span><span class="o">=</span><span class="k">$(</span>curl <span class="s2">&quot;$mbrz/artist?fmt=json&amp;limit=1&amp;query=Pearl%20Jam&quot;</span><span class="k">)</span>
<span class="nv">name</span><span class="o">=</span><span class="k">$(</span>teepee -I <span class="s2">&quot;$pjq&quot;</span> -v artists.0.name<span class="k">)</span>
<span class="nv">country</span><span class="o">=</span><span class="k">$(</span>teepee -I <span class="s2">&quot;$pjq&quot;</span> -v artists.0.country<span class="k">)</span>
<span class="nb">echo</span> <span class="s2">&quot;$name rock from the $country&quot;</span><span class="s1">&#39;!&#39;</span>
<span class="c"># Pearl Jam rock from the US!</span>

<span class="c"># let&#39;s just isolate data about Pearl Jam from the query response</span>
<span class="nv">pj</span><span class="o">=</span><span class="k">$(</span>teepee -I <span class="s2">&quot;$pjq&quot;</span> -F<span class="s1">&#39;YAML(V &quot;artists.0&quot;)&#39;</span><span class="k">)</span>
<span class="nv">year</span><span class="o">=</span><span class="k">$(</span>teepee -I <span class="s2">&quot;$pj&quot;</span> -v <span class="s2">&quot;&#39;life-span&#39;.begin&quot;</span><span class="k">)</span>
<span class="nv">city</span><span class="o">=</span><span class="k">$(</span>teepee -I <span class="s2">&quot;$pj&quot;</span> -v <span class="s2">&quot;&#39;begin-area&#39;.name&quot;</span><span class="k">)</span>
<span class="nb">echo</span> <span class="s2">&quot;they started from $city in $year&quot;</span>
<span class="c"># they started from Seattle in 1990</span>

<span class="c"># we can also pretty-print, especially handy with compact JSON</span>
<span class="nv">ap</span><span class="o">=</span><span class="s1">&#39;http://www.astro-phys.com/api/de406&#39;</span>
curl <span class="s2">&quot;$ap/coefficients?date=1972-11-9&amp;bodies=mars&quot;</span>
<span class="c"># {&quot;date&quot;: 2441630.5, &quot;type&quot;: &quot;chebyshev&quot;, &quot;results&quot;: {&quot;mars&quot;: ...</span>
curl <span class="s2">&quot;$ap/coefficients?date=1972-11-9&amp;bodies=mars&quot;</span> <span class="se">\</span>
    <span class="p">|</span> teepee -FYAML
<span class="c"># ---</span>
<span class="c"># date: 2441630.5</span>
<span class="c"># results:</span>
<span class="c">#   mars:</span>
<span class="c">#     coefficients:</span>
<span class="c">#       -</span>
<span class="c">#         - -221246363.667206</span>
<span class="c">#         - 26761105.8067001</span>
<span class="c">#         ...</span>
<span class="c">#     end: 2441680.5</span>
<span class="c">#     start: 2441616.5</span>
<span class="c"># type: chebyshev</span>
<span class="c"># unit: km</span>

<span class="c"># or do the pretty-printing of a sub-section only</span>
teepee -I <span class="s2">&quot;$pj&quot;</span> -F<span class="s1">&#39;YAML(V &quot;aliases&quot;)&#39;</span>
<span class="c"># ---</span>
<span class="c"># -</span>
<span class="c">#   begin-date: ~</span>
<span class="c">#   end-date: ~</span>
<span class="c">#   locale: ~</span>
<span class="c">#   name: &#39;Mookie Blaylock&#39;</span>
<span class="c">#   primary: ~</span>
<span class="c">#   sort-name: &#39;Mookie Blaylock&#39; type: ~</span></code></pre></div>

<p><em>No, I didn’t know Pearl Jam had an alias as Mookie Blaylock!</em></p>

<h2 id="setting-up">Setting Up</h2>

<p>To get up to speed in the examples, you need <code>teepee</code> and
<a href="http://curl.haxx.se/">curl</a>.</p>

<p><code>teepee</code> is easy to install, especially in the <a href="https://github.com/polettix/teepee/raw/master/bundle/teepee">bundled
version</a>:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>curl -LO <span class="se">\</span>
    https://github.com/polettix/teepee/raw/master/bundle/teepee
<span class="nv">$ </span>chmod +x teepee</code></pre></div>

<p>We will assume the directory where you place <code>teepee</code> is in the <code>PATH</code>,
otherwise you can move it in some directory that is. (e.g.
<code>usr/local/bin</code>). You shouldn’t need anything more than Perl 5.8 to be
able to run it (please report any issues!).</p>

<p>In case you don’t have <code>curl</code>, you can try to see if you have <a href="https://www.gnu.org/software/wget/">GNU
Wget</a> instead. In this case, a quick
and dirty replacement for the examples below can be the following
<code>alias</code>:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">alias </span><span class="nv">curl</span><span class="o">=</span><span class="s1">&#39;wget -O -&#39;</span></code></pre></div>

<p>Last, but not least, we will use <code>bash</code> as our shell of election in the
following examples. You are smart enough to figure out what to change in
case you want to use something different!</p>

<h2 id="getting-a-value">Getting A Value</h2>

<p>The basic <em>use case</em> is probably just getting a value from a JSON or
YAML structured file. You will need:</p>

<ul>
  <li>some <em>input</em> structured data</li>
  <li>the <em>path</em> of the variable in the data</li>
</ul>

<p>To make things clearer, let’s start playing with the following sample
input data:</p>

<pre><code>---
name: Flavio
surname: Poletti
cpan:
    id: POLETTIX
    metacpan: https://metacpan.org/author/POLETTIX
    latest:
        - Data::Crumbr
        - Template::Perlish
        - Graphics::Potrace
        - Log::Log4perl::Tiny
    favorites:
        Dancer: YANICK
        JSON: MAKAMAKA
        Moo: HAARG
</code></pre>

<p>We’ll assume the above text is in file <code>input.yaml</code>, so we have our
<em>input</em>.</p>

<p>What’s a <em>path</em> then? It’s how you can reach the value you’re interested
into starting from the root of the data structure, all the way down,
with components separated by dots. For example, who’s the current
maintainer of <code>Moo</code>?</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>teepee -i input.yaml -v cpan.favorites.Moo
HAARG<span class="nv">$ </span><span class="c"># OK but next prompt is on the same line and it&#39;s UGLY...</span></code></pre></div>

<p>The first two options we just saw are:</p>

<dl>
  <dt><code>-i</code></dt>
  <dd>is for inputs. They can be JSON or YAML, and <code>teepee</code> will try to
auto-detect. You can be explicit and use <code>-j</code> and <code>-y</code>, you can guess
what for what;</dd>
  <dt><code>-v</code></dt>
  <dd>is for variable’s path. As anticipated, the different
keys/indexes, separated by dots (more on this later!).</dd>
</dl>

<p>Well, we managed to get the value we were after, but it would be nice to
have a newline when printing out to the terminal. No worries, there’s
option <code>-n</code> to the rescue:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>teepee -i input.yaml -nv cpan.favorites.Dancer
YANICK
<span class="nv">$ </span><span class="c"># now the next prompt is on its own new line!</span></code></pre></div>

<p>This option is useful only for printing things to the terminal,
otherwise you can ignore it, e.g. when just filling up some variables:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ metacpan_uri</span><span class="o">=</span><span class="k">$(</span>teepee -i input.yaml -v cpan.metacpan<span class="k">)</span>
<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">&quot;$metacpan_uri&quot;</span>
https://metacpan.org/author/POLETTIX</code></pre></div>

<p>So far so good, but probably not that impressive as we could have
obtained the same with some <code>grep</code> and <code>sed</code> magic. In this case
probably yes, but what if data were shaped like this instead:</p>

<pre><code>---
name: Flavio
surname: Poletti
cpan:
    id: POLETTIX
    metacpan: https://metacpan.org/author/POLETTIX
    latest:
        - Data::Crumbr
        - Template::Perlish
        - Graphics::Potrace
        - Log::Log4perl::Tiny
    using:
        JSON:
            id: 'https://metacpan.org/release/JSON'
    favorites:
        Dancer:
            id: YANICK
        JSON:
            id: MAKAMAKA
        Moo:
            id: HAARG
</code></pre>

<p>Note that I added a <code>using</code> hash that has itself a <code>JSON</code> element inside,
and changed how <code>id</code>s are associated to the distributions. To make
things funnier, the shape of <code>using</code> and of <code>favorites</code> is the same, but
with different data. Well, <em>now</em> it’s a bit more difficult to get the
<em>right</em> id for the JSON inside <code>favorites</code>, isn’t it? It’s a trivial
change in calling <code>teepee</code> though:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># --------------------------------------------vvv</span>
<span class="nv">$ </span>teepee -i input2.yaml -nv cpan.favorites.JSON.id
MAKAMAKA</code></pre></div>

<p>I hope you appreciate the simplification.</p>

<p>In case you’re wondering, accessing arrays just means using the right
index in the right place:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>teepee -i input.yaml -nv cpan.latest.1
Template::Perlish</code></pre></div>

<p>The assumption (at least so far) is that you know exactly how your data
are shaped, including the position of elements inside arrays. We will
see later in section <a href="#array">Iterating Over an Array</a> that there are
functions that allow us to iterate over data structures, so that we can
partially<sup id="fnref:partially"><a href="#fn:partially" class="footnote">2</a></sup> remove this assumption.</p>

<h2 id="using-available-inputs">Using Available Inputs</h2>

<p>If you’re consuming an API, chances are you’re actually doing remote
calls (e.g. with <code>curl</code>) and getting responses back.</p>

<p>You are polite enough to understand that if you need three values from
the same response… you don’t have to make three different calls,
right? One alternative (apart using temporary files, of course) is to
save the response in a shell variable, which works for local files a
well of course:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># cache query result in a variable, for using over and over</span>
<span class="nv">$ mcpan_input</span><span class="o">=</span><span class="k">$(</span>curl <span class="s2">&quot;http://api.metacpan.org/v0/author/POLETTIX&quot;</span><span class="k">)</span>

<span class="c"># read file contents in a convenience variable</span>
<span class="nv">$ local_input</span><span class="o">=</span><span class="k">$(</span>&lt; input.yaml<span class="k">)</span></code></pre></div>

<p>In this case, you can use the <em>immediate</em> parameters, that are the
uppercase counterparts of the file-base input parameters:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># auto-detect</span>
<span class="nv">$ PAUSE_ID</span><span class="o">=</span><span class="k">$(</span>teepee -I <span class="s2">&quot;$local_input&quot;</span> -v cpan.id<span class="k">)</span>

<span class="c"># force interpreting as YAML</span>
<span class="nv">$ name</span><span class="o">=</span><span class="k">$(</span>teepee -Y <span class="s2">&quot;$local_input&quot;</span> -v name<span class="k">)</span>

<span class="c"># force interpreting as JSON</span>
<span class="nv">$ fullname</span><span class="o">=</span><span class="k">$(</span>teepee -J <span class="s2">&quot;$mcpan_input&quot;</span> -v name<span class="k">)</span></code></pre></div>

<p>Remember to put double quotes around the variable with the data, or the
shell will make a mess!</p>

<h2 id="expanding-templates">Expanding Templates</h2>

<p>Getting variables is handy, but what if you want to generate something a
bit more evolved? You can use
<a href="https://metacpan.org/pod/Template::Perlish">Template::Perlish</a> for
this, e.g. with a template passed directly on the command line as text
with option <code>-T</code>:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>teepee -i input.yaml -nT <span class="s1">&#39;Hello, I am [% name%] [% surname %]&#39;</span>
Hello, I am Flavio Poletti</code></pre></div>

<p>Templates can live in files, of course. Again, what’s immediate on the
command line as an uppercase option <code>-T</code> becomes a lowercase option <code>-t</code>
when taken from a file:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>cat story.txt
Hello, my name is <span class="o">[</span>% name %<span class="o">]</span> <span class="o">[</span>% surname %<span class="o">]</span>.
Lorem ipsum...

<span class="nv">$ </span>teepee -i input.yaml -t story.txt
Hello, my name is Flavio Poletti.
Lorem ipsum...</code></pre></div>

<p>This can come quite handy when you’re doing API consumption where you
have to send JSON text back and forth. For example, one way to see one’s
favorite distributions on <em>meta::cpan</em> is to POST the following query:</p>

<pre><code>{
    "fields": [ "distribution" ],
    "filter" : { "term" : { "user" : "[% user %]" } },
    "size": 100
}
</code></pre>

<p>We will store the above template in <code>favorites-for.json</code>.</p>

<p>We need the user identifier, which is easy to retrieve from the author’s
profile:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ me</span><span class="o">=</span><span class="k">$(</span>curl <span class="s2">&quot;http://api.metacpan.org/v0/author/POLETTIX&quot;</span><span class="k">)</span>
<span class="nv">$ </span>teepee -I <span class="s2">&quot;$me&quot;</span> -nv user
NwdPuW9vRBGuIdSr4Gw26g
<span class="nv">$ query</span><span class="o">=</span><span class="k">$(</span>teepee -I <span class="s2">&quot;$me&quot;</span> -t favorites-for.json<span class="k">)</span>
<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">&quot;$query&quot;</span>
<span class="o">{</span>
    <span class="s2">&quot;fields&quot;</span>: <span class="o">[</span> <span class="s2">&quot;distribution&quot;</span> <span class="o">]</span>,
    <span class="s2">&quot;filter&quot;</span> : <span class="o">{</span> <span class="s2">&quot;term&quot;</span> : <span class="o">{</span> <span class="s2">&quot;user&quot;</span> : <span class="s2">&quot;NwdPuW9vRBGuIdSr4Gw26g&quot;</span> <span class="o">}</span> <span class="o">}</span>,
    <span class="s2">&quot;size&quot;</span>: 100
<span class="o">}</span>
<span class="nv">$ favs</span><span class="o">=</span><span class="k">$(</span>curl -XPOST <span class="s2">&quot;http://api.metacpan.org/v0/favorite/_search&quot;</span> <span class="se">\</span>
              -d <span class="s2">&quot;$query&quot;</span><span class="k">)</span>
<span class="nv">$ </span>teepee -I <span class="s2">&quot;$favs&quot;</span> -nT <span class="s1">&#39;I have [% hits.total %] favorites&#39;</span>
I have <span class="m">13</span> favorites</code></pre></div>

<p>As you are correctly thinking now, this requires that the template is
shaped to accept exactly the data structure coming from the response,
which is a bit stiff. We’ll see later how to use even more general
inputs.</p>

<h2 id="array">Iterating Over an Array</h2>

<p>Our last query result contained as much as 13 favorites, in an array
shaped like this:</p>

<pre><code>{
    "hits" : {
        "hits" : [
            {
                "fields" : {
                    "distribution" : "Template-Toolkit"
                },
                "_score" : 1,
                "_type" : "favorite",
                "_id" : "vx77xt7X5e_a1pr66pq_QJvhbJs",
                "_index" : "cpan_v1"
            },
            {
                "_index" : "cpan_v1",
                "_id" : "DD1K8tb8s2oNX8RN1UZEL6wijUQ",
                "fields" : {
                    "distribution" : "Pod-Markdown"
                },
                "_type" : "favorite",
                "_score" : 1
            },
            ...
</code></pre>

<p>How to get a list of distribution names? We might <code>grep</code>, of course, or
use a bit of Perl with
<a href="https://metacpan.org/pod/Template::Perlish">Template::Perlish</a>:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>teepee -I <span class="s2">&quot;$favs&quot;</span> -T <span class="s1">&#39;My favorites:</span>
<span class="s1">[% for my $hit (A &quot;hits.hits&quot;) {</span>
<span class="s1">   %]- [%= $hit-&gt;{fields}{distribution} %]</span>
<span class="s1">[% } %]&#39;</span>
My favorites:
- Template-Toolkit
- Pod-Markdown
- GraphViz
- Pinto
- Parse-RecDescent
- Path-Class
- Dancer
- JSON
- WWW-Mechanize
- Dist-Zilla
- WWW-Mechanize-Shell
- libwww-perl
- Moo</code></pre></div>

<p>We already saw that option <code>-T</code> allows us to set a generic template.
What’s good is that the template can also contain Perl code.</p>

<p>The really handy thing here is the <code>A</code> function, that works on a <em>path</em>
(string <code>"hits.hits"</code> in this case) and, assuming it leads to an array
reference, expands the reference to a list of items. In our case, each
item is a hash where the interesting part is inside <code>fields</code>, then
inside <code>distribution</code>.</p>

<h2 id="handy-shortcuts">Handy Shortcuts</h2>

<p>We saw in <a href="#array">Iterating Over an Array</a> that it’s possible to use a
function <code>A</code> in the templates, that takes a template path and expands
it into a list. There are a few of additional functions:</p>

<ul>
  <li><code>V</code> expands to a single value. It might be a leaf scalar or an
intermediate data structure, you should know what you have though;</li>
  <li><code>H</code> expands a hash reference to the list intermixing keys and values;</li>
  <li><code>HK</code> expands a hash reference into the list if its keys;</li>
  <li><code>HV</code> expands a hash reference into the list of its values.</li>
</ul>

<p>They all take a <em>path</em>, either as a string or as a reference to an array
containing the different crumbs in the sequence.</p>

<p>The functions also accept an optional second parameter, assumed to be a
reference to a data structure. When present, it is visited instead of
the top-level data structure. Hence, the last example in the previous
section can be rewritten as follows:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>teepee -I <span class="s2">&quot;$favs&quot;</span> -T <span class="s1">&#39;My favorites:</span>
<span class="s1">[%</span>
<span class="s1">    for my $hit (A &quot;hits.hits&quot;) { %]- [%=</span>
<span class="s1">        V(&quot;fields.distribution&quot;, $hit) %]</span>
<span class="s1">[% } %]&#39;</span>
My favorites:
- Template-Toolkit
...</code></pre></div>

<h2 id="yet-another-input-channel">Yet Another Input Channel</h2>

<p>There is an interesting <a href="https://metacpan.org/">meta::cpan</a> query
<a href="https://github.com/CPAN-API/cpan-api/blob/master/docs/API-docs.md#get-the-latest-version-numbers-of-your-favorite-modules">get the latest version numbers of your favorite
modules</a>
that can be expressed in the following template:</p>

<pre><code>{
    "query" : { "terms" :
        { "release.distribution" : [% list_array %] } },
    "filter" : { "term" : { "release.status" : "latest" } },
    "fields" : [ "distribution", "version" ],
    "size"   : [% size %]
}
</code></pre>

<p>We’ll save the above template in <code>lastv-favs.json</code>.</p>

<p>Now, of course, the issue is to get <code>list_array</code> and <code>size</code> for <em>your</em>
favorites. In the previous section we already saw mine, so we can
generate something suitable for <code>list_array</code> as follows:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ list_array</span><span class="o">=</span><span class="k">$(</span>teepee -I <span class="s2">&quot;$favs&quot;</span> -T <span class="s1">&#39;[ [%=</span>
<span class="s1">    join &quot;, &quot;, map { qq[&quot;$_-&gt;{fields}{distribution}&quot;]}</span>
<span class="s1">        A &quot;hits.hits&quot;;</span>
<span class="s1">%] ]&#39;</span><span class="k">)</span>
<span class="nv">$ size</span><span class="o">=</span><span class="k">$(</span>teepee -I <span class="s2">&quot;$favs&quot;</span> -v hits.total<span class="k">)</span></code></pre></div>

<p>Now we have our expansion values inside shell variables… how do we
pass them to <code>teepee</code> for expanding the template above? This is where
option <code>-d</code> comes handy, because it allows you to define variable
valued directly on the command line:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ query</span><span class="o">=</span><span class="k">$(</span>teepee -t <span class="s2">&quot;lastv-favs.json&quot;</span> <span class="se">\</span>
    -d <span class="nv">list_array</span><span class="o">=</span><span class="s2">&quot;$list_array&quot;</span> <span class="se">\</span>
    -d <span class="nv">size</span><span class="o">=</span><span class="s2">&quot;$size&quot;</span><span class="k">)</span></code></pre></div>

<p>But wait! Why does it seem to be stuck at this point? The fact is that
by default <code>teepee</code> expects to read some input, and it goes to standard
input by default. If you don’t want it to get any <em>regular</em> input (as
in this case, in which you define variables directly) you can use option
<code>-N</code>:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ query</span><span class="o">=</span><span class="k">$(</span>teepee -Nt <span class="s2">&quot;lastv-favs.json&quot;</span> <span class="se">\</span>
    -d <span class="nv">list_array</span><span class="o">=</span><span class="s2">&quot;$list_array&quot;</span> <span class="se">\</span>
    -d <span class="nv">size</span><span class="o">=</span><span class="s2">&quot;$size&quot;</span><span class="k">)</span>
<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">&quot;$query&quot;</span>
<span class="o">{</span>
    <span class="s2">&quot;query&quot;</span> : <span class="o">{</span> <span class="s2">&quot;terms&quot;</span> :
        <span class="o">{</span> <span class="s2">&quot;release.distribution&quot;</span> : <span class="o">[</span> <span class="s2">&quot;Template-Toolkit&quot;</span>, ... <span class="o">]</span> <span class="o">}</span> <span class="o">}</span>,
    <span class="s2">&quot;filter&quot;</span> : <span class="o">{</span> <span class="s2">&quot;term&quot;</span> : <span class="o">{</span> <span class="s2">&quot;release.status&quot;</span> : <span class="s2">&quot;latest&quot;</span> <span class="o">}</span> <span class="o">}</span>,
    <span class="s2">&quot;fields&quot;</span> : <span class="o">[</span> <span class="s2">&quot;distribution&quot;</span>, <span class="s2">&quot;version&quot;</span> <span class="o">]</span>,
    <span class="s2">&quot;size&quot;</span>   : 13
<span class="o">}</span></code></pre></div>

<p>We’re now ready to run our query:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ lfv</span><span class="o">=</span><span class="k">$(</span>curl -XPOST <span class="s2">&quot;http://api.metacpan.org/v0/release/_search&quot;</span> <span class="se">\</span>
             -d <span class="s2">&quot;$query&quot;</span><span class="k">)</span>
<span class="nv">$ </span>teepee -I <span class="s2">&quot;$lfv&quot;</span> -T <span class="s1">&#39;My favorites with latest version:</span>
<span class="s1">[%</span>
<span class="s1">    for my $hit (A &quot;hits.hits&quot;) {</span>
<span class="s1">        my $f = $hit-&gt;{fields};</span>
<span class="s1">        print &quot;- $f-&gt;{distribution} ($f-&gt;{version})\n&quot;;</span>
<span class="s1">    }</span>
<span class="s1">%]&#39;</span>
My favorites with latest version:
- Path-Class <span class="o">(</span>0.35<span class="o">)</span>
- Pod-Markdown <span class="o">(</span>3.003<span class="o">)</span>
- GraphViz <span class="o">(</span>2.19<span class="o">)</span>
- WWW-Mechanize-Shell <span class="o">(</span>0.55<span class="o">)</span>
- Parse-RecDescent <span class="o">(</span>1.967013<span class="o">)</span>
- Moo <span class="o">(</span>2.000002<span class="o">)</span>
- WWW-Mechanize <span class="o">(</span>1.75<span class="o">)</span>
- JSON <span class="o">(</span>2.90<span class="o">)</span>
- libwww-perl <span class="o">(</span>6.15<span class="o">)</span>
- Template-Toolkit <span class="o">(</span>2.26<span class="o">)</span>
- Pinto <span class="o">(</span>0.11<span class="o">)</span>
- Dist-Zilla <span class="o">(</span>5.042<span class="o">)</span>
- Dancer <span class="o">(</span>1.3202<span class="o">)</span></code></pre></div>

<h2 id="reshaping">Reshaping</h2>

<p>In our last example, we extracted information from the first query into
two variables, then used them to build up a new template for our next
query. This surely works, but might become cumbersome (and intensive in
terms of process-calling) if you want to take more than a handful of
values.</p>

<p>If you’re going to use <code>teepee</code> on the data, like in our example, an
efficient alternative is to build up a new JSON/YAML data structure out
of your input data:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ reshaped</span><span class="o">=</span><span class="k">$(</span>teepee -I <span class="s2">&quot;$favs&quot;</span> -NT <span class="s1">&#39;---</span>
<span class="s1">size: [% hits.total %]</span>
<span class="s1">distros:</span>
<span class="s1">[% for my $hit (A &quot;hits.hits&quot;) { %]   - &quot;[%=</span>
<span class="s1">        $hit-&gt;{fields}{distribution} %]&quot;</span>
<span class="s1">[% } %]&#39;</span><span class="k">)</span>
<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">&quot;$reshaped&quot;</span>
---
size: 13
distros:
   - <span class="s2">&quot;Template-Toolkit&quot;</span>
   - <span class="s2">&quot;Pod-Markdown&quot;</span>
   - <span class="s2">&quot;GraphViz&quot;</span>
   - <span class="s2">&quot;Pinto&quot;</span>
   - <span class="s2">&quot;Parse-RecDescent&quot;</span>
   - <span class="s2">&quot;Path-Class&quot;</span>
   - <span class="s2">&quot;Dancer&quot;</span>
   - <span class="s2">&quot;JSON&quot;</span>
   - <span class="s2">&quot;WWW-Mechanize&quot;</span>
   - <span class="s2">&quot;Dist-Zilla&quot;</span>
   - <span class="s2">&quot;WWW-Mechanize-Shell&quot;</span>
   - <span class="s2">&quot;libwww-perl&quot;</span>
   - <span class="s2">&quot;Moo&quot;</span></code></pre></div>

<p>We will have to modify our template at this point, but it’s also cleaner
to expect an array as input and handle the shaping in the template
itself. Here’s our second take at the template (we will call the file
<code>lastv-favs-2.json</code>):</p>

<pre><code>{
    "query" : {
        "terms" : {
            "release.distribution" : [ [%
                print join ", ", map { qq{"$_"} } A 'distros';
            %] ]
        }
    },
    "filter" : { "term" : { "release.status" : "latest" } },
    "fields" : [ "distribution", "version" ],
    "size"   : [% size %]
}
</code></pre>

<p>The query then becomes:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ query</span><span class="o">=</span><span class="k">$(</span>teepee -t <span class="s2">&quot;lastv-favs-2.json&quot;</span> -Y<span class="s2">&quot;$reshaped&quot;</span><span class="k">)</span></code></pre></div>

<p>with similar results as before.</p>

<p>This reshaping does not necessarily have to be applied for generating
new YAML or JSON though. If you’re still interested into getting values
into shell variables, you can prepare the right text and then <code>eval</code> it,
to get all values in one shot:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ variables</span><span class="o">=</span><span class="k">$(</span>teepee -I <span class="s2">&quot;$favs&quot;</span> -T <span class="s1">&#39;list_array=[%=</span>
<span class="s1">    my $list = join &quot;, &quot;, map { qq[&quot;$_-&gt;{fields}{distribution}&quot;]}</span>
<span class="s1">        A &quot;hits.hits&quot;;</span>
<span class="s1">    quotemeta(&quot;[ $list ]&quot;);</span>
<span class="s1">%]</span>
<span class="s1">size=[%= quotemeta(V &quot;hits.total&quot; ) %]</span>
<span class="s1">&#39;</span><span class="k">)</span>
<span class="nv">$ </span><span class="nb">eval</span> <span class="s2">&quot;$variables&quot;</span>
<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">&quot;size: $size - array: $list_array&quot;</span>
size: <span class="m">13</span> - array: <span class="o">[</span> <span class="s2">&quot;Template-Toolkit&quot;</span>, <span class="s2">&quot;Pod-Markdown&quot;</span>, ...</code></pre></div>

<blockquote>
  <p><strong>Don’t use <code>eval</code> unless you’re 200% sure about what you are
doing!</strong> To be on the safe side, either avoid this technique
completely, or use it only on data you trust.</p>
</blockquote>

<h2 id="pretty-printing-and-isolating">Pretty-Printing and Isolating</h2>

<p>Some APIs choose to return pretty-printed data, trading some space for
ease of use. Other ones go for compactness, and leave you the <em>burden</em>
to pretty print the response if you need to read it (as a human).</p>

<p><code>teepee</code> allows you to re-print your input data either in JSON or YAML
format. This also comes handy if you want to trasform from one to the
other, by the way; so you might have data that is already
pretty-printed, and re-pretty-print it into another format (I usually
find YAML a better reading experience).</p>

<p>Pretty-printing is done through a couple of functions that are available
in the templates; unsurprisingly, these functions are called <code>YAML</code> and
<code>JSON</code>. This is how it would be done:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ ap</span><span class="o">=</span><span class="s1">&#39;http://www.astro-phys.com/api/de406&#39;</span>
<span class="nv">$ mars</span><span class="o">=</span><span class="k">$(</span>curl <span class="s2">&quot;$ap/coefficients?date=1972-11-9&amp;bodies=mars&quot;</span><span class="k">)</span>
<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">&quot;$mars&quot;</span>
<span class="o">{</span><span class="s2">&quot;date&quot;</span>: 2441630.5, <span class="s2">&quot;type&quot;</span>: <span class="s2">&quot;chebyshev&quot;</span>, <span class="s2">&quot;results&quot;</span>: <span class="o">{</span><span class="s2">&quot;mars&quot;</span>: ...

<span class="nv">$ </span>teepee -J <span class="s2">&quot;$mars&quot;</span> -T <span class="s1">&#39;[%= YAML %]&#39;</span>
---
date: 2441630.5
results:
  mars:
    coefficients:
      -
        - -221246363.667206
        - 26761105.8067001
        ...
      -
        - -80259893.9503651
        - -50770737.7568579
        ...
    end: 2441680.5
    start: 2441616.5
<span class="nb">type</span>: chebyshev
unit: km</code></pre></div>

<p><code>JSON</code> would work similarly. This construct is so handy that it made
sense to provide a slightly shorter way to type it. In particular,
option <code>-F</code> provides a way to specify a template without too much
boilerplate, so the following two calls are actually equivalent:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>teepee -Fwhatever ...
<span class="c"># ...</span>
<span class="nv">$ </span>teepee -T <span class="s1">&#39;[%= whatever %]&#39;</span></code></pre></div>

<p>Hence, pretty-printing in YAML is as simple as this:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>teepee -FYAML -J <span class="s2">&quot;$mars&quot;</span>
---
date: 2441630.5
results:
...</code></pre></div>

<p>The two functions can also take an optional parameter, namely a
reference to a data structure. Guess what? They will pretty-print that!
So, if we are interested only in the <code>results.mars.coefficients</code> we can
isolate them as follows:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ coeffs</span><span class="o">=</span><span class="k">$(</span>teepee -F<span class="s1">&#39;YAML V &quot;results.mars.coefficients&quot;&#39;</span> -J<span class="s2">&quot;$mars&quot;</span><span class="k">)</span>
<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">&quot;$coeffs&quot;</span>
---
-
  - -221246363.667206
  - 26761105.8067001
  - 4016544.02022364
...</code></pre></div>

<p>This can be useful if you’re only interested into a subsection of a
complex response, because you can isolate that subsection into a shell
variable (like <code>$coeffs</code> in our example above) and then run <code>teepee</code>
over that variable with shorter paths.</p>

<h2 id="a-few-examples">A Few Examples</h2>

<p>Here are a few examples of consuming APIs from the shell with the help
of <code>teepee</code>… I hope they will inspire you!</p>

<h3 id="whats-the-weather-like">What’s the Weather Like?</h3>

<p><a href="http://openweathermap.org/">OpenWeatherMap</a> <em>delivers 1 billion</em>
[weather] <em>forecasts per day</em>. It should be able to cope with a few
requests from us!</p>

<p>To use it, you will need to register (freely) at <a href="http://home.openweathermap.org/users/sign_up">the registration
page</a> and get an API key.</p>

<blockquote>
  <p>Yes, I know that the examples in the <a href="http://openweathermap.org/current">Current Weather
  Data</a> page work fine and include a
  valid API key, but you SHOULD get your own key to be fair!</p>
</blockquote>

<p>Every API call is a <code>GET</code> and parameters are passed in the URI, encoded.
One of them is the API key, so we’ll start with the following
definition:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ key</span><span class="o">=</span>YOUR-API-KEY-HERE</code></pre></div>

<p>Accessing the latest weather data is as simple as sending a query to
<code>http://api.openweathermap.org/data/2.5/weather?appid=$key</code>. Response
parameters are explained <a href="http://openweathermap.org/current">here</a>. We
will format a little report according to the following template (saved
as <code>weather.tmpl</code>):</p>

<pre><code>[%
    # convenience function for cutting excess decimals
    sub fmt { return sprintf '%.1lf', shift; }
%]Hi! Here's some facts about [% name %] [[% sys.country %]]:
  - position is about latitude [% coord.lat %]N and longitude [%
      coord.lon %]E
  - [% weather.0.main %]: [% weather.0.description %]
  - temperature is [%= fmt(V('main.temp') - 273.15) %]°C ([%=
      fmt(V('main.temp_min') - V('main.temp')) %]/+[%=
      fmt(V('main.temp_max') - V('main.temp')) %]°C)
  - humidity is [% main.humidity %]%
  - last sunrise was on [%= scalar localtime V('sys.sunrise') %]
  - last sunset  was on [%= scalar localtime V('sys.sunset') %]
</code></pre>

<p>Now, we’re ready to get some facts about Roma, my city:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ owm_weather_api</span><span class="o">=</span><span class="s2">&quot;http://api.openweathermap.org/data/2.5/weather&quot;</span>
<span class="nv">$ </span>curl <span class="s2">&quot;$owm_weather_api?appid=$key&amp;q=Roma,it&quot;</span> <span class="se">\</span>
    <span class="p">|</span> teepee -t weather.tmpl
Hi! Here are some facts about Roma <span class="o">[</span>IT<span class="o">]</span>:
  - position is about latitude 41.89N and longitude 12.48E
  - Clear: Sky is Clear
  - temperature is 8.1°C <span class="o">(</span>-2.1/+0.9°C<span class="o">)</span>
  - humidity is 87%
  - last sunrise was on Tue Dec <span class="m">15</span> 07:31:04 2015
  - last sunset  was on Tue Dec <span class="m">15</span> 16:39:56 2015</code></pre></div>

<p>Not exactly hot… but lovely for this time of the year in the night,
isn’t it? Let’s look how it will go in the coming days, using
<code>forecast-daily.tmpl</code>:</p>

<pre><code>[%
    sub fmt { sprintf '%.1lf', shift }
%]Forecast for [% city.name %] [[% city.country %]] ([%
        city.coord.lat %]N, [% city.coord.lon %]E):[%
    for my $day (A 'list') {
%]
- [%= (my $d = scalar localtime $day-&gt;{dt}) =~ s{\d\d:.*}{}mxs;
    $d; %]: [%=
        fmt $day-&gt;{temp}{min} %]°C/[%= fmt $day-&gt;{temp}{max} %]°C [%=
        $day-&gt;{weather}[0]{main} %] ([%=
        $day-&gt;{weather}[0]{description} %])[%
    }
%]
</code></pre>

<p>and the following query:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ owm_fd</span><span class="o">=</span><span class="s2">&quot;http://api.openweathermap.org/data/2.5/forecast/daily&quot;</span>
<span class="nv">$ </span>curl <span class="s2">&quot;$owm_fd?appid=$key&amp;q=Roma,it&amp;units=metric&amp;cnt=16&quot;</span> <span class="se">\</span>
    <span class="p">|</span> teepee -t forecast-daily.tmpl
Forecast <span class="k">for</span> Roma <span class="o">[</span>IT<span class="o">]</span> <span class="o">(</span>41.894741N, 12.4839E<span class="o">)</span>:
  - Tue Dec <span class="m">15</span> : 7.3°C/7.8°C Clear <span class="o">(</span>sky is clear<span class="o">)</span>
  - Wed Dec <span class="m">16</span> : 5.8°C/12.6°C Clouds <span class="o">(</span>few clouds<span class="o">)</span>
  - Thu Dec <span class="m">17</span> : 4.2°C/11.4°C Clear <span class="o">(</span>sky is clear<span class="o">)</span>
  - Fri Dec <span class="m">18</span> : 8.4°C/13.3°C Rain <span class="o">(</span>light rain<span class="o">)</span>
  - Sat Dec <span class="m">19</span> : 9.9°C/11.5°C Rain <span class="o">(</span>moderate rain<span class="o">)</span>
  - Sun Dec <span class="m">20</span> : 6.2°C/12.1°C Clear <span class="o">(</span>sky is clear<span class="o">)</span>
  - Mon Dec <span class="m">21</span> : 7.0°C/13.4°C Rain <span class="o">(</span>light rain<span class="o">)</span>
  - Tue Dec <span class="m">22</span> : 10.0°C/13.2°C Rain <span class="o">(</span>light rain<span class="o">)</span>
  - Wed Dec <span class="m">23</span> : 13.5°C/15.2°C Rain <span class="o">(</span>light rain<span class="o">)</span>
  - Thu Dec <span class="m">24</span> : 9.2°C/15.4°C Clear <span class="o">(</span>sky is clear<span class="o">)</span>
  - Fri Dec <span class="m">25</span> : 7.9°C/14.5°C Clear <span class="o">(</span>sky is clear<span class="o">)</span>
  - Sat Dec <span class="m">26</span> : 10.9°C/14.7°C Rain <span class="o">(</span>light rain<span class="o">)</span>
  - Sun Dec <span class="m">27</span> : 9.2°C/14.2°C Rain <span class="o">(</span>light rain<span class="o">)</span>
  - Mon Dec <span class="m">28</span> : 7.2°C/13.6°C Rain <span class="o">(</span>light rain<span class="o">)</span>
  - Tue Dec <span class="m">29</span> : 10.0°C/13.4°C Rain <span class="o">(</span>light rain<span class="o">)</span>
  - Wed Dec <span class="m">30</span> : 10.6°C/14.4°C Rain <span class="o">(</span>light rain<span class="o">)</span></code></pre></div>

<p>A little too rainy for my taste… but it’s life!</p>

<h3 id="where-can-i-go-from">Where Can I Go From…</h3>

<p><a href="https://en.wikipedia.org/">Wikipedia</a> is the biggest online
encyclopedia, and can be a real time drag as you go through the pages,
following links over links (even only internal).</p>

<p>For example… how many links are contained in a few pages, e.g. about
<code>Perl</code>, <code>Bash</code> or <code>Pearl Jam</code>? Let’s see:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ wp</span><span class="o">=</span><span class="s1">&#39;https://en.wikipedia.org/w/api.php&#39;</span>
<span class="nv">$ wpq</span><span class="o">=</span><span class="s2">&quot;$wp?action=query&amp;prop=links&amp;format=json&amp;pllimit=500&quot;</span>
<span class="nv">$ </span><span class="k">for</span> title in <span class="s1">&#39;Perl&#39;</span> <span class="s1">&#39;Bash&#39;</span> <span class="s1">&#39;Pearl_Jam&#39;</span> <span class="p">;</span> <span class="k">do</span>
    curl -s <span class="s2">&quot;$wpq&amp;titles=$title&quot;</span> <span class="se">\</span>
        <span class="p">|</span> teepee -nT <span class="s1">&#39;[%=</span>
<span class="s1">            my ($d) = HV &quot;query.pages&quot;;</span>
<span class="s1">            my $n = scalar @{$d-&gt;{links}};</span>
<span class="s1">            &quot;$d-&gt;{title}: $n&quot;;</span>
<span class="s1">          %]&#39;</span>
  <span class="k">done</span>
Perl: 450
Bash: 14
Pearl Jam: 455</code></pre></div>

<p>Well… it seems that there is a <em>slight</em> better chance to get lost
reading about Pearl Jam than about Perl, but they’re almost there
together!</p>

<h3 id="whats-the-last-xkcd-strip">What’s the Last xkcd Strip?</h3>

<p>I hope you love <a href="http://xkcd.com/">xkcd</a> as much as I do. You’re in the
terminal and you would like to know what’s the last strip, just to see
if there’s anything new…</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>curl http://xkcd.com/info.0.json <span class="se">\</span>
    <span class="p">|</span> teepee -n <span class="se">\</span>
        -T <span class="s1">&#39;#[%num%] &quot;[%safe_title%]&quot;, [%year%]-[%month%]-[%day%]&#39;</span>
<span class="c">#1616 &quot;Lunch&quot;, 2015-12-14</span></code></pre></div>

<p>When you call it you don’t get too much data, e.g.:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ xkcd_last</span><span class="o">=</span><span class="k">$(</span>curl http://xkcd.com/info.0.json<span class="k">)</span>
<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">&quot;$xkcd_last&quot;</span>
<span class="o">{</span><span class="s2">&quot;month&quot;</span>: <span class="s2">&quot;12&quot;</span>, <span class="s2">&quot;num&quot;</span>: 1616, <span class="s2">&quot;link&quot;</span>: <span class="s2">&quot;&quot;</span>, <span class="s2">&quot;year&quot;</span>: <span class="s2">&quot;2015&quot;</span>, <span class="s2">&quot;news&quot;</span>: <span class="s2">&quot;&quot;</span>, <span class="s2">&quot;safe_title&quot;</span>: <span class="s2">&quot;Lunch&quot;</span>, <span class="s2">&quot;transcript&quot;</span>: <span class="s2">&quot;&quot;</span>, <span class="s2">&quot;alt&quot;</span>: <span class="s2">&quot;I&#39;m trying to be healthier, so after I eat this brick of cheese, I&#39;ll have a spoonful of grease-soaked vegetables.&quot;</span>, <span class="s2">&quot;img&quot;</span>: <span class="s2">&quot;http:\/\/imgs.xkcd.com\/comics\/lunch.png&quot;</span>, <span class="s2">&quot;title&quot;</span>: <span class="s2">&quot;Lunch&quot;</span>, <span class="s2">&quot;day&quot;</span>: <span class="s2">&quot;14&quot;</span><span class="o">}</span></code></pre></div>

<p>Well… it’s not that readable, is it? All that scrolling to the
right… This can use some pretty printing, e.g. in YAML:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>teepee -J <span class="s2">&quot;$xkcd_last&quot;</span> -FYAML
---
alt: <span class="s2">&quot;I&#39;m trying to be healthier, so after I eat this brick of cheese, I&#39;ll have a spoonful of grease-soaked vegetables.&quot;</span>
day: <span class="s1">&#39;14&#39;</span>
img: http://imgs.xkcd.com/comics/lunch.png
link: <span class="s1">&#39;&#39;</span>
month: <span class="s1">&#39;12&#39;</span>
news: <span class="s1">&#39;&#39;</span>
num: 1616
safe_title: Lunch
title: Lunch
transcript: <span class="s1">&#39;&#39;</span>
year: <span class="s1">&#39;2015&#39;</span></code></pre></div>

<h3 id="and-so-on">… And So On…</h3>

<p>I hope you got your feet wet at this point. Be sure to go (again)
through the examples in section <a href="#quick">Quick! Show Me Something!</a>,
they can be a bit more understandable at this point!</p>

<h2 id="times-up">Time’s Up!</h2>

<p>If you made it to the end of this article… congratulations! I hope you
will consider <code>teepee</code> as a tool worth using in your next shell project.</p>

<p>If you want to play a bit, a good entry point for finding out APIs to do
some testing is <a href="http://www.programmableweb.com/">Programmable Web</a>,
although for Perl enthusiast also <a href="https://metacpan.org/">meta::cpan</a> is
worth a look. Some good starting points that do not require registration
are the following:</p>

<ul>
  <li>
    <p><a href="http://metacpan.org/">meta::cpan</a> is a fast growing (feature-wise)
search tool for CPAN. <a href="https://github.com/CPAN-API/cpan-api/blob/master/docs/API-docs.md">meta::cpan
APIs</a>
(<a href="http://api.metacpan.org/">entry point</a>) allow programmale access to
the database.</p>
  </li>
  <li>
    <p><a href="http://musicbrainz.org/">MusicBrainz</a> is an open music encyclopedia
that collects music metadata and makes it available to the public.
<a href="http://musicbrainz.org/doc/Development">Development</a> explains how to
consume their APIs, with details on the <a href="http://musicbrainz.org/doc/Development/JSON_Web_Service">JSON
interface</a>.
(<a href="http://musicbrainz.org/ws/2/">Entry point</a>).</p>
  </li>
  <li>
    <p><a href="http://hacktheuniverse.github.io/star-api/">Star API</a> <em>provides access
the Digital Universe Data set</em>. (<a href="http://star-api.herokuapp.com/api/v1/stars">Entry
point</a>).</p>
  </li>
  <li>
    <p><a href="http://openweathermap.org/">OpenWeatherMap</a> <em>delivers 1 billion
forecasts per day</em>. API description is
<a href="http://openweathermap.org/api">here</a>. Well, you’re supposed to
register actually, as already written before…</p>
  </li>
  <li>
    <p><a href="https://en.wikipedia.org">Wikipedia</a> is a wonderful resource for
information… although you always have to remember that it’s not
fully peer-reviewed. It has an <a href="https://www.mediawiki.org/wiki/API:Tutorial">API
Tutorial</a>.</p>
  </li>
  <li>
    <p><a href="http://xkcd.com">xkcd</a> is <em>A webcomic of romance, sarcasm, math, and
language</em>. Very funny. API hints <a href="https://xkcd.com/json.html">here</a>.</p>
  </li>
</ul>

<p>There are many more… including your very own API for the next-decade
killer application!</p>

<div class="footnotes">
  <ol>
    <li id="fn:credits">

      <p>Photo credits: <a href="http://www.loc.gov/pictures/item/95522788/">Teepees on the
Columbia</a>
by Ralph Irving Gifford, <a href="http://www.loc.gov/pictures/item/95500540/">Ute
Pagre</a> by H.H. Tammen. <a href="#fnref:credits" class="reversefootnote">&#x2934;</a></p>
    </li>
    <li id="fn:partially">
      <p>You are still supposed to know how your data are <em>shaped</em>,
although you might not know where the different elements in an array
are placed. <a href="#fnref:partially" class="reversefootnote">&#x2934;</a></p>
    </li>
  </ol>
</div>

      <hr />
      <footer role="contentinfo">
        <div class="social-share">
  <h4>Share on</h4>
  <ul>
    <li>
      <a href="https://twitter.com/intent/tweet?text=/teepee/" class="twitter" title="Share on Twitter"><i class="fa fa-twitter"></i><span> Twitter</span></a>
    </li>
    <li>
      <a href="https://www.facebook.com/sharer/sharer.php?u=/teepee/" class="facebook" title="Share on Facebook"><i class="fa fa-facebook"></i><span> Facebook</span></a>
    </li>
    <li>
      <a href="https://plus.google.com/share?url=/teepee/" class="google-plus" title="Share on Google Plus"><i class="fa fa-google-plus"></i><span> Google+</span></a>
    </li>
  </ul>
</div><!-- /.social-share -->
        <p class="byline"><strong>TeePee</strong> was published on <time datetime="2015-12-27T00:00:00+01:00">December 27, 2015</time>.</p>
      </footer>
    </div><!-- /.article-wrap -->
  
    <section id="disqus_thread"></section><!-- /#disqus_thread -->
  
  </article>
</div><!-- /#main -->

<div class="footer-wrap">
  <div class="related-articles">
  <h4>You might also enjoy <small class="pull-right">(<a href="/posts/">View all posts</a>)</small></h4>
    <ul>
    
      <li><a href="/dibs-saga/" title="Dibs Saga">Dibs Saga</a></li>
    
      <li><a href="/dibs-envars-envisaged-as-enviles/" title="Dibs - Envars Envisaged As Enviles">Dibs - Envars Envisaged As Enviles</a></li>
    
      <li><a href="/dibs-remote-packs/" title="Dibs - Remote Packs">Dibs - Remote Packs</a></li>
    
    </ul>
    <hr />
  </div><!-- /.related-articles -->
  <footer>
    

<span>&copy; 2019 Flavio Poletti. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> using the <a href="http://mademistakes.com/minimal-mistakes/" rel="nofollow">Minimal Mistakes</a> theme.</span>

  </footer>
</div><!-- /.footer-wrap -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="/assets/js/scripts.min.js"></script>


  
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'polettix'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>



</body>
</html>
