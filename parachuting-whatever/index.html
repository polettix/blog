<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Parachuting Whatever &#8211; PolettiX!</title>
<meta name="description" content="Many times I craft things that have to be installed in some place,
which means that an installer is a nice thing to have. Here&#8217;s one,
Perl-based.

">
<meta name="keywords" content="">



<!-- Twitter Cards -->
<meta name="twitter:title" content="Parachuting Whatever">
<meta name="twitter:description" content="Many times I craft things that have to be installed in some place,
which means that an installer is a nice thing to have. Here&#8217;s one,
Perl-based.

">
<meta name="twitter:site" content="@polettix">
<meta name="twitter:creator" content="@polettix">

<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="/images/kakadu-volo-insieme.jpg">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Parachuting Whatever">
<meta property="og:description" content="Many times I craft things that have to be installed in some place,
which means that an installer is a nice thing to have. Here&#8217;s one,
Perl-based.

">
<meta property="og:url" content="/parachuting-whatever/">
<meta property="og:site_name" content="PolettiX!">





<link rel="canonical" href="/parachuting-whatever/">
<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="PolettiX! Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<meta http-equiv="cleartype" content="on">

<!-- HTML5 Shiv and Media Query Support -->
<!--[if lt IE 9]>
	<script src="/assets/js/vendor/html5shiv.min.js"></script>
	<script src="/assets/js/vendor/respond.min.js"></script>
<![endif]-->

<!-- Modernizr -->
<script src="/assets/js/vendor/modernizr-2.7.1.custom.min.js"></script>

<link href='//fonts.googleapis.com/css?family=PT+Sans+Narrow:400,700%7CPT+Serif:400,700,400italic' rel='stylesheet' type='text/css'>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="/favicon.ico?whatever">
<!-- 32x32 -->
<link rel="shortcut icon" href="/favicon.png?whatever">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/images/apple-touch-icon-144x144-precomposed.png">

</head>

<body class="post">

<!--[if lt IE 9]><div class="browser-upgrade alert alert-info">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div><![endif]-->

<div class="navigation-wrapper">
	<div class="site-name">
		<a href="/">PolettiX!</a>
	</div><!-- /.site-name -->
	<div class="top-navigation">
		<nav role="navigation" id="site-nav" class="nav">
		    <ul>
		        
				    
				        
				    
				    <li><a href="/about/" >About</a></li>
				
				    
				        
				    
				    <li><a href="/posts/" >Posts</a></li>
				
		    </ul>
		</nav>
	</div><!-- /.top-navigation -->
</div><!-- /.navigation-wrapper -->


  <div class="image-wrap">
  <img src=
    
      "/images/kakadu-volo-insieme.jpg"
    
  alt="Parachuting Whatever feature image">
  
    <span class="image-credit"><a href="https://en.wikipedia.org/wiki/Kakadu_National_Park">Uccelli al Kakadu National Park, Australia</a></span>
  
  </div><!-- /.image-wrap -->


<div id="main" role="main">
  <div class="article-author-side">
    


<div itemscope itemtype="http://schema.org/Person">


	<img src="/images/flavio-self-color.png" class="bio-photo" alt="Flavio Poletti bio photo">


  <h3 itemprop="name">Flavio Poletti</h3>
  <p>Irreducible Perler.</p>
  <a href="mailto:flavio@polettix.it" class="author-social" target="_blank"><i class="fa fa-fw fa-envelope-square"></i>Email</a>
  <a href="http://comics.polettix.it/" class="author-social" target="_blank"><i class="fa fa-fw fa-pencil"></i> Comics</a>
  <a href="http://twitter.com/polettix" class="author-social" target="_blank"><i class="fa fa-fw fa-twitter-square"></i> Twitter</a>
  
  
  <a href="http://linkedin.com/in/flaviopoletti" class="author-social" target="_blank"><i class="fa fa-fw fa-linkedin-square"></i> LinkedIn</a>
  
  
  <a href="https://metacpan.org/author/polettix" class="author-social" target="_blank"><i class="fa fa-fw fa-th-large"></i> MetaCPAN</a>
  <a href="http://github.com/polettix" class="author-social" target="_blank"><i class="fa fa-fw fa-github"></i> Github</a>
  <a href="http://stackoverflow.com/users/3865403/polettix" class="author-social" target="_blank"><i class="fa fa-fw fa-stack-overflow"></i> Stackoverflow</a>
  
  
  <a href="http://www.pinterest.com/polettix" class="author-social" target="_blank"><i class="fa fa-fw fa-pinterest"></i> Pinterest</a>
  
  
  
  
  
  
</div>

  </div>
  <article class="post">
    <div class="headline-wrap">
      
        <h1><a href="/parachuting-whatever/" rel="bookmark" title="Parachuting Whatever">Parachuting Whatever</a></h1>
      
    </div><!--/ .headline-wrap -->
    <div class="article-wrap">
      <p>Many times I craft things that have to be installed in some place,
which means that an installer is a nice thing to have. Here’s one,
Perl-based.</p>

<p>The basic idea that probably anyone has for a poor man’s deployment
system is to pack stuff in a tarball, together with a deployment
script inside that has to be executed in the target machine. Without
too much fantasy, I figured that I could walk the extra mile and
make a package that behaves like a tarball with a twist - i.e. it
is capable of executing things after unpacking.</p>

<h2 id="tldr">TL;DR</h2>

<p>Download <a href="/assets/files/deployable"><em>self-contained bundled version</em></a> and save
it as <code>deployable</code> in some directory in your <code>PATH</code>. Make sure it’s
executable too.</p>

<p>Put your stuff in a directory. The current directory is fine. Assume
it is exactly as you want it to appear when you unpack in the
destination. Include a deployment script, i.e. the one that you usually
include for starting the real deployment after unpacking –we’ll call
it <code>deploy.sh</code>– and make sure it’s executable. You should have
something like this in the directory:</p>

<pre><code>deploy.sh
file1.foo
file2.bar
somedir/
...
</code></pre>

<p>To generate <code>package.pl</code> ready for deployment, run:</p>

<pre><code>deployable -o package.pl -d deploy.sh \
    file1.foo file2.bar somedir ...
</code></pre>

<p>Ship <code>package.pl</code>, execute in place and you’re done.</p>

<h2 id="enter-deployable">Enter <a href="http://repo.or.cz/w/deployable.git">deployable</a></h2>

<p><a href="http://repo.or.cz/w/deployable.git">deployable</a> is a handful of tools to help you with remote management
of multiple servers. It was born when there was no Puppet or Chef in
town - not that I know of, at least - and worked pretty well for me.</p>

<p>In this post we’ll concentrate on the main script –named after the
bunch of tools– i.e. the one that allows you to generate smart
packages.</p>

<p>Before continuing, if you find it interesting, please note that you
will need to carry also the <code>remote</code> script with you, together with
installing dependencies. If you like compact packages - and you
probably do if you’re interested in packing thing smartly - you
can download the <a href="/assets/files/deployable"><em>bundled</em> version</a>. Ensure to
put it in some place in <code>PATH</code> and to set its execution bits, this
is what we will assume in the rest of this post.</p>

<p>So what was your workflow before <a href="http://repo.or.cz/w/deployable.git">deployable</a>? Let’s assume it was
something like this:</p>

<ol>
  <li>place all relevant files in a directory (possibly in a subdirectory)</li>
  <li>add a deployment script to the directory</li>
  <li>create a tarball of that directory</li>
  <li>write instructions to unpack the tarball and execute the
deployment script inside the directory that is created</li>
  <li>ship the tarball and the instructions</li>
</ol>

<p>Something along the following line:</p>

<pre><code>mkdir foobar
cp /lots/of/stuff/* foobar
vi foobar/deploy.sh # and put what's needed
chmod +x foobar/deploy.sh
tar cvzf package.tar.gz foobar
</code></pre>

<p>You actually don’t have to change your workflow that much. If you
want to stick to it, you can <em>still</em> put all your stuff in a directory,
like the first bullet above, and create a package with the whole
contents of that directory via <a href="http://repo.or.cz/w/deployable.git">deployable</a> instead of the last step
in the example above:</p>

<pre><code># preparation goes exactly like before, but packaging is:
deployable -o /path/to/package.pl -H foobar -d deploy.sh
</code></pre>

<p>You end up with <code>/path/to/package.pl</code> (you can omit the path to create it
in the current directory of course). At this point, you hardly have to
write any instructions: just tell your recipients to put the script in
the destination server with the execution bits turned on, and execute it.</p>

<p>So what does that command do? Easy:</p>

<ul>
  <li>option <code>-o</code> sets the output. If not set, the resulting script will
be printed on standard output, but if you provide a filename
<a href="http://repo.or.cz/w/deployable.git">deployable</a> will make it executable</li>
  <li>option <code>-H</code> (alias <code>--heredir</code>) tells <a href="http://repo.or.cz/w/deployable.git">deployable</a> where your stuff
is (in terms of a directory). The contents of the directory will
be included in the package, but the initial path set with <code>-H</code> will
be stripped away. In the example above, file <code>foobar/deploy.sh</code> will
be included simply as <code>deploy.sh</code> (actually, as <code>./deploy.sh</code>). This
is useful if you want to store all files/directories to be shipped
in one single place, but you don’t care about the containing
directory</li>
  <li>option <code>-d</code> tells <a href="http://repo.or.cz/w/deployable.git">deployable</a> that the specified file (i.e.
<code>deploy.sh</code> in our example) has to be executed. You can specify
whatever file you include, even multiple ones; only remember that
the path to the files that you include will be referred to their
position in the package, so in our example you have to specify it
as <code>deploy.sh</code> instead of <code>foobar/deploy.sh</code> because <code>foobar</code> is
stripped away.</li>
</ul>

<h2 id="shortcuts">Shortcuts?</h2>

<p>Here are some shortcuts that <a href="http://repo.or.cz/w/deployable.git">deployable</a> provides.</p>

<h3 id="stuff-in-current-directory">Stuff in current directory</h3>

<p>If you just want to ship some files in the current directory, you’re not
obliged to use <code>-H</code> at all, just tell <a href="http://repo.or.cz/w/deployable.git">deployable</a> which files you want
to include. Remember that they will be recorded with the path you provide.</p>

<pre><code>deployable -o p.pl file1 file2 ...
</code></pre>

<h3 id="execute-multiple-deployment-programs">Execute multiple deployment programs</h3>

<p>If you want to execute multiple programs, make sure they are all
executable and pass them with multiple <code>-d</code> options:</p>

<pre><code>deployable -o p.pl -d exec1 -d exec2 exec1 exec2 file1 ...
</code></pre>

<p>If you want to execute all executable files inside the default <em>current</em>
directory, you can just pass the <code>-X</code> command line parameter. Beware that
it will execute whatever it finds, so make sure that this is what you
actually want:</p>

<pre><code>deployable -o p.pl -X exec1 exec2 file1 ...
</code></pre>

<h3 id="install-stuff-in-place">Install stuff in place</h3>

<p>At the time that I needed it, chances where that I had to update
some system files in multiple machines at once. This meant that I
wanted the tarball to <em>optionally</em> extract things based on the
root directory (i.e. <code>/</code>) so that the files go in place.</p>

<p>While this is not hard to do with what explained above –it’s a
matter of crafting the <code>deploy.sh</code> script for this– it was too
handy to leave outside. You have two ways:</p>

<ul>
  <li>create a directory <code>target-root</code> and put all the stuff you want
to install like <code>target-root</code> were the root directory <code>/</code> of the
target system, or</li>
  <li>include files/directories (presumably inside the current directory)
to be directly extracted in the root directory <code>/</code> of the target
system.</li>
</ul>

<p>If you go the first way, this is how you call <a href="http://repo.or.cz/w/deployable.git">deployable</a>:</p>

<pre><code>deployable -o p.pl -r target-root
</code></pre>

<p>You can of course add scripts to call within the same command line. If
you’re more into the second, this is how you do it:</p>

<pre><code>deployable -o p.pl -R etc
</code></pre>

<h2 id="the-surface-is-scratched-now">The surface is scratched now…</h2>

<p><a href="http://repo.or.cz/w/deployable.git">deployable</a> has plenty of documentation. After installing it, you can
run either of these commands, in increasing level of verbosity:</p>

<pre><code>deployable --usage
deployable --help
deployable --man
</code></pre>

<p>and read it. Have fun!</p>

      <hr />
      <footer role="contentinfo">
        <div class="social-share">
  <h4>Share on</h4>
  <ul>
    <li>
      <a href="https://twitter.com/intent/tweet?text=/parachuting-whatever/" class="twitter" title="Share on Twitter"><i class="fa fa-twitter"></i><span> Twitter</span></a>
    </li>
    <li>
      <a href="https://www.facebook.com/sharer/sharer.php?u=/parachuting-whatever/" class="facebook" title="Share on Facebook"><i class="fa fa-facebook"></i><span> Facebook</span></a>
    </li>
    <li>
      <a href="https://plus.google.com/share?url=/parachuting-whatever/" class="google-plus" title="Share on Google Plus"><i class="fa fa-google-plus"></i><span> Google+</span></a>
    </li>
  </ul>
</div><!-- /.social-share -->
        <p class="byline"><strong>Parachuting Whatever</strong> was published on <time datetime="2015-02-15T00:00:00+01:00">February 15, 2015</time>.</p>
      </footer>
    </div><!-- /.article-wrap -->
  
    <section id="disqus_thread"></section><!-- /#disqus_thread -->
  
  </article>
</div><!-- /#main -->

<div class="footer-wrap">
  <div class="related-articles">
  <h4>You might also enjoy <small class="pull-right">(<a href="/posts/">View all posts</a>)</small></h4>
    <ul>
    
      <li><a href="/gerrit-import-the-hard-way/" title="Gerrit import - the hard way">Gerrit import - the hard way</a></li>
    
      <li><a href="/parachuting-perl/" title="Parachuting Perl">Parachuting Perl</a></li>
    
      <li><a href="/github-pages/" title="GitHub Pages">GitHub Pages</a></li>
    
    </ul>
    <hr />
  </div><!-- /.related-articles -->
  <footer>
    

<span>&copy; 2015 Flavio Poletti. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> using the <a href="http://mademistakes.com/minimal-mistakes/" rel="nofollow">Minimal Mistakes</a> theme.</span>

  </footer>
</div><!-- /.footer-wrap -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="/assets/js/scripts.min.js"></script>


  
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'polettix'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>



</body>
</html>
